"use strict";const o=require("electron"),s=require("node:path"),w=require("node:fs"),u=require("node:os");process.env.DIST=s.join(__dirname,"../dist");process.env.PUBLIC=o.app.isPackaged?process.env.DIST:s.join(process.env.DIST,"../public");let n;const l=process.env.VITE_DEV_SERVER_URL;function h(){n=new o.BrowserWindow({icon:s.join(process.env.PUBLIC,"vite.svg"),webPreferences:{preload:s.join(__dirname,"preload.js")},width:1024,height:768}),n.webContents.on("did-finish-load",()=>{n==null||n.webContents.send("main-process-message",new Date().toLocaleString())}),l?n.loadURL(l):n.loadFile(s.join(process.env.DIST,"index.html"))}const f={silent:!0,printBackground:!0,color:!0,margin:{marginType:"printableArea"},landscape:!1,pagesPerSheet:1,collate:!1,copies:1};o.ipcMain.handle("printComponent",async(c,a)=>{const e=new o.BrowserWindow({show:!1});return e.webContents.on("did-finish-load",()=>{const t=s.join(u.homedir(),"Desktop","temp.pdf");e.webContents.printToPDF({}).then(i=>{w.writeFile(t,i,r=>{if(r)throw r;console.log(`Wrote PDF successfully to ${t}`)})}).catch(i=>{console.log(`Failed to write PDF to ${t}: `,i)})}),await e.loadURL(a),"shown print dialog"});o.ipcMain.handle("previewComponent",async(c,a)=>{let e=new o.BrowserWindow({title:"Print Preview",show:!1,autoHideMenuBar:!0});return e.webContents.once("did-finish-load",()=>{e.webContents.printToPDF(f).then(t=>{const d="data:application/pdf;base64,"+Buffer.from(t).toString("base64");e.webContents.on("ready-to-show",()=>{e.once("page-title-updated",p=>p.preventDefault()),e.show()}),e.webContents.on("closed",()=>e=null),e.loadURL(d)}).catch(t=>{console.log(t)})}),await e.loadURL(a),"shown preview window"});o.app.on("window-all-closed",()=>{n=null});o.app.whenReady().then(h);
