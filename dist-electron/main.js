"use strict";const o=require("electron"),s=require("node:path"),p=require("node:fs"),u=require("node:os");process.env.DIST=s.join(__dirname,"../dist");process.env.PUBLIC=o.app.isPackaged?process.env.DIST:s.join(process.env.DIST,"../public");let t;const d=process.env.VITE_DEV_SERVER_URL;function h(){t=new o.BrowserWindow({icon:s.join(process.env.PUBLIC,"vite.svg"),webPreferences:{preload:s.join(__dirname,"preload.js")},width:1024,height:768}),t.webContents.on("did-finish-load",()=>{t==null||t.webContents.send("main-process-message",new Date().toLocaleString())}),d?t.loadURL(d):t.loadFile(s.join(process.env.DIST,"index.html"))}const f={silent:!0,printBackground:!0,color:!0,margin:{marginType:"printableArea"},landscape:!1,pagesPerSheet:1,collate:!1,copies:1};o.ipcMain.handle("SaveDataBase",async(c,a)=>{const e=s.join(__dirname,"../src/assets/Config.json");return p.writeFile(e,a,n=>{if(n)throw n;console.log("Data Saved")}),"data saved"});o.ipcMain.handle("printComponent",async(c,a,e)=>{const n=new o.BrowserWindow({show:!1});return n.webContents.on("did-finish-load",()=>{const i=s.join(u.homedir(),"Desktop/pdf",`${e}.pdf`);n.webContents.printToPDF({preferCSSPageSize:!0,printBackground:!0,pageSize:"A4"}).then(r=>{p.writeFile(i,r,l=>{if(l)throw l;console.log(`Wrote PDF successfully to ${i}`)})}).catch(r=>{console.log(`Failed to write PDF to ${i}: `,r)})}),await n.loadURL(a),"shown print dialog"});o.ipcMain.handle("previewComponent",async(c,a)=>{let e=new o.BrowserWindow({title:"Print Preview",show:!1,autoHideMenuBar:!0});return e.webContents.once("did-finish-load",()=>{e.webContents.printToPDF(f).then(n=>{const l="data:application/pdf;base64,"+Buffer.from(n).toString("base64");e.webContents.on("ready-to-show",()=>{e.once("page-title-updated",w=>w.preventDefault()),e.show()}),e.webContents.on("closed",()=>e=null),e.loadURL(l)}).catch(n=>{console.log(n)})}),await e.loadURL(a),"shown preview window"});o.app.on("window-all-closed",()=>{t=null});o.app.whenReady().then(h);
